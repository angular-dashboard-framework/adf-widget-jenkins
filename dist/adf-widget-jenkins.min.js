!function(t,e){"use strict";function a(t){t.widget("jenkins",{title:"Jenkins Project View",description:"Widget to display custom jenkins job",templateUrl:"{widgetsPath}/jenkins/src/view.html",resolve:{data:["jenkinsApi","config","jenkinsEndpoint",function(t,e,a){return e.apiUrl?t.getJobData(e.apiUrl,e.project):a.url&&e.project?t.getJobData(a.url,e.project):void 0}]},controller:"jenkinsJobList",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/jenkins/src/edit.html"}}).widget("jenkinsStats",{title:"Jenkins Global Statistics",description:"Widget to diplay chart statistics from jenkins",templateUrl:"{widgetsPath}/jenkins/src/charts/view.html",resolve:{data:["jenkinsApi","config","jenkinsEndpoint",function(t,e,a){return e.apiUrl?t.getJobStats(e.apiUrl):a.url?t.getJobStats(a.url):"Please Setup the Widget"}]},controller:"jenkinsChart",controllerAs:"jc",edit:{templateUrl:"{widgetsPath}/jenkins/src/charts/edit.html"}})}function n(t){function e(t){return t+"/api/json/jobs"}function a(t,e){return t+"/job/"+e+"/lastBuild/api/json"}function n(t){for(var e=0,a=0,n=0,l=0,o=0,i=t.length,r=0;i>r;r++)"blue"==t[r].color&&e++,"red"==t[r].color&&n++,"yellow"==t[r].color&&a++,"notbuilt"!=t[r].color&&"disabled"!=t[r].color||l++,"aborted"==t[r].color&&o++;var s={stable:e,fail:n,unstable:a,aborted:o,disabled:l,total:i};return s}function l(a){var n=e(a);return t({method:"GET",url:n,headers:{Accept:"application/json"}}).then(function(t){return t.data.jobs})}function o(t,e){return l(t).then(getBuilds(t))}function i(e,n){var l=a(e,n);return t({method:"GET",url:l,headers:{Accept:"application/json"}}).then(function(t){var e=t.data.result,a=t.data.url,n=t.data.fullDisplayName,l="";"SUCCESS"==e&&(l="src/img/thumbUp.png"),"FAILURE"==e&&(l="src/img/thumbDown.png");var o=t.data.changeSet.items[0],i="Kein Infos zum letzen Commit",r="Keine Infos zum Autor";o&&(r=o.author.fullName,i=o.msg);var s={status:e,url:a,lastCommitBy:r,lastCommitMsg:i,imgUrl:l,projectFullName:n};return s})}function r(t){return l(t).then(n)}return{getJobStats:r,getJobData:i,getLastBuilds:o}}var l=angular.module("adf.widget.jenkins",["adf.provider","chart.js"]).constant("jenkinsEndpoint",{url:"http://builds.apache.org"}).config(a);a.$inject=["dashboardProvider"],angular.module("adf.widget.jenkins").run(["$templateCache",function(t){t.put("{widgetsPath}/jenkins/src/edit.html",'<form role=form><div class=form-group><label for=sample>Connection Setup</label><p><input class=form-control id=apiUrl ng-model=config.apiUrl placeholder="Enter Api-Url" type=text></p><label for=sample>Project</label><p><input class=form-control id=project ng-model=config.project placeholder=Project type=text></p></div></form>'),t.put("{widgetsPath}/jenkins/src/view.html",'<style type=text/css>\n\n  .counter {\n    outline: 2px solid #ddd;\n    height: 100px;\n  }\n  .statusImg {\n    max-width: 150px;\n  }\n  .projectLink {\n    padding-top: 10%;\n  }\nblockquote{\n  margin-top: 20%;\n}\n\n\n</style><div><div class=content><div><a class="col-md-12 col-xs-12" href=\'{{vm.data.url}}target="_blank"\'><img class="col-md-6 col-xs-6 statusImg" src={{vm.data.imgUrl}}><h4 class="col-md-6 col-xs-6 projectLink">{{vm.data.projectFullName}}</h4></a><br><blockquote><p>{{vm.data.lastCommitMsg}}</p><footer>{{vm.data.lastCommitBy}}</footer></blockquote></div></div></div>'),t.put("{widgetsPath}/jenkins/src/charts/edit.html",'<form role=form><div class=form-group><label for=sample>Connection Setup</label><p><input class=form-control id=apiUrl ng-model=config.apiUrl placeholder="Enter Api-Url" type=text></p></div></form>'),t.put("{widgetsPath}/jenkins/src/charts/view.html",'<style type=text/css>\n  #stable{\n    background-color: #01B7EB;\n  }\n  #failed{\n    background-color: #F7464A;\n  }\n  #unstable{\n    background-color: #FDB45C;\n  }\n  #disabled{\n    background-color: #DCDCDC;\n  }\n  .counter {\n    outline: 2px solid #ddd;\n    height: 100px;\n  }\n</style><div><div class=content><canvas id=doughnut class="chart chart-doughnut" chart-data=jc.chartValues chart-labels=jc.chartLabels chart-colours=jc.chartColors></canvas><div class="counter col-md-6" id=stable><h1>{{jc.data.stable || 0}}</h1>stable builds</div><div class="counter col-md-6" id=unstable><h1>{{jc.data.unstable || 0}}</h1>unstable builds</div><div class="counter col-md-6" id=failed><h1>{{jc.data.fail || 0}}</h1>failed builds</div><div class="counter col-md-6" id=disabled><h1>{{jc.data.aborted+jc.data.disabled || 0}}</h1>disabled builds</div></div></div>')}]),l.controller("jenkinsChart",["data",function(t){var e=this;e.data=t;var a=["Stable","Fail","Unstable","Diabled"],n=[e.data.stable,e.data.fail,e.data.unstable,e.data.disabled],l=["#01B7EB","#F7464A","#FDB45C","#DCDCDC"];e.chartLabels=a,e.chartValues=n,e.chartColors=l}]),l.controller("jenkinsJobList",["data",function(t){var e=this;e.data=t}]),l.factory("jenkinsApi",n),n.$inject=["$http"]}(window);