!function(t,e){"use strict";function n(t){t.widget("jenkins",{title:"Jenkins Project View",description:"Widget to display custom jenkins job",templateUrl:"{widgetsPath}/jenkins/src/view.html",resolve:{data:["jenkinsApi","config","jenkinsEndpoint",function(t,e,n){return e.apiUrl?t.getJobData(e.apiUrl,e.project):n.url&&e.project?t.getJobData(n.url,e.project):void 0}]},controller:"jenkinsJobList",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/jenkins/src/edit.html",controller:"projectViewEditController",controllerAs:"vm"}}).widget("jenkinsStats",{title:"Jenkins Global Statistics",description:"Widget to diplay chart statistics from jenkins",templateUrl:"{widgetsPath}/jenkins/src/charts/view.html",resolve:{data:["jenkinsApi","config","jenkinsEndpoint",function(t,e,n){return e.apiUrl?t.getJobStats(e.apiUrl):n.url?t.getJobStats(n.url):"Please Setup the Widget"}]},controller:"jenkinsChart",controllerAs:"jc",edit:{templateUrl:"{widgetsPath}/jenkins/src/charts/edit.html"}})}function a(t){function e(t){return t+"/api/json/jobs"}function n(t,e){return t+"/job/"+e+"/lastBuild/api/json"}function a(t){for(var e=0,n=0,a=0,o=0,i=0,r=t.length,l=0;r>l;l++)"blue"==t[l].color&&e++,"red"==t[l].color&&a++,"yellow"==t[l].color&&n++,"notbuilt"!=t[l].color&&"disabled"!=t[l].color||o++,"aborted"==t[l].color&&i++;var s={stable:e,fail:a,unstable:n,aborted:i,disabled:o,total:r};return s}function o(n){var a=e(n);return t({method:"GET",url:a,headers:{Accept:"application/json"}}).then(function(t){return t.data.jobs})}function i(t,e){return o(t).then(getBuilds(t))}function r(e,a){var o=n(e,a);return t({method:"GET",url:o,headers:{Accept:"application/json"}}).then(function(t){var e=t.data.result,n=t.data.url,a=t.data.fullDisplayName,o="";"SUCCESS"==e&&(o="http://iconmonstr.com/wp-content/g/gd/makefg.php?i=../assets/preview/2013/png/iconmonstr-thumb-18.png&r=0&g=0&b=0"),"FAILURE"==e&&(o="http://iconmonstr.com/wp-content/g/gd/makefg.php?i=../assets/preview/2013/png/iconmonstr-thumb-24.png&r=0&g=0&b=0");var i=t.data.changeSet.items[0],r="Kein Infos zum letzen Commit",l="Keine Infos zum Autor";i&&(l=i.author.fullName,r=i.msg);var s={status:e,url:n,lastCommitBy:l,lastCommitMsg:r,imgUrl:o,projectFullName:a};return s})}function l(t){return o(t).then(a)}return{getJobList:o,getJobStats:l,getJobData:r,getLastBuilds:i}}var o=angular.module("adf.widget.jenkins",["adf.provider","chart.js"]).constant("jenkinsEndpoint",{url:"http://builds.apache.org"}).config(n);n.$inject=["dashboardProvider"],angular.module("adf.widget.jenkins").run(["$templateCache",function(t){t.put("{widgetsPath}/jenkins/src/edit.html",'<form role=form><div class=form-group><label for=sample>Connection Setup</label><p><input class=form-control id=apiUrl ng-model=config.apiUrl placeholder="Enter Api-Url" type=text ng-change=updateProjects()></p><label for=sample>Project</label><select name=project id=project class=form-control ng-model=config.project><option ng-repeat="project in vm.projects | orderBy: \'name\'">{{project.name}}</option></select></div></form>'),t.put("{widgetsPath}/jenkins/src/view.html",'<style type=text/css>\n\n  .counter {\n    outline: 2px solid #ddd;\n    height: 100px;\n  }\n  .statusImg {\n    max-width: 150px;\n  }\n  .projectLink {\n    padding-top: 10%;\n  }\nblockquote{\n  margin-top: 20%;\n}\n\n\n</style><div><div class=content><div><a class="col-md-12 col-xs-12" href=\'{{vm.data.url}}target="_blank"\'><img class="col-md-6 col-xs-6 statusImg" src={{vm.data.imgUrl}}><h4 class="col-md-6 col-xs-6 projectLink">{{vm.data.projectFullName}}</h4></a><br><blockquote><p>{{vm.data.lastCommitMsg}}</p><footer>{{vm.data.lastCommitBy}}</footer></blockquote></div></div></div>'),t.put("{widgetsPath}/jenkins/src/charts/edit.html",'<form role=form><div class=form-group><label for=sample>Connection Setup</label><p><input class=form-control id=apiUrl ng-model=config.apiUrl placeholder="Enter Api-Url" type=text></p></div></form>'),t.put("{widgetsPath}/jenkins/src/charts/view.html",'<style type=text/css>\n  #stable{\n    background-color: #01B7EB;\n  }\n  #failed{\n    background-color: #F7464A;\n  }\n  #unstable{\n    background-color: #FDB45C;\n  }\n  #disabled{\n    background-color: #DCDCDC;\n  }\n  .counter {\n    outline: 2px solid #ddd;\n    height: 100px;\n  }\n</style><div><div class=content><canvas id=doughnut class="chart chart-doughnut" chart-data=jc.chartValues chart-labels=jc.chartLabels chart-colours=jc.chartColors></canvas><div class="counter col-md-6" id=stable><h1>{{jc.data.stable || 0}}</h1>stable builds</div><div class="counter col-md-6" id=unstable><h1>{{jc.data.unstable || 0}}</h1>unstable builds</div><div class="counter col-md-6" id=failed><h1>{{jc.data.fail || 0}}</h1>failed builds</div><div class="counter col-md-6" id=disabled><h1>{{jc.data.aborted+jc.data.disabled || 0}}</h1>disabled builds</div></div></div>')}]),o.controller("jenkinsChart",["data",function(t){var e=this;e.data=t;var n=["Stable","Fail","Unstable","Diabled"],a=[e.data.stable,e.data.fail,e.data.unstable,e.data.disabled],o=["#01B7EB","#F7464A","#FDB45C","#DCDCDC"];e.chartLabels=n,e.chartValues=a,e.chartColors=o}]),o.controller("jenkinsJobList",["data",function(t){var e=this;e.data=t}]),o.factory("jenkinsApi",a),a.$inject=["$http"],angular.module("adf.widget.jenkins").controller("projectViewEditController",["jenkinsApi","$scope","jenkinsEndpoint",function(t,e,n){var a=this;e.updateProjects=function(){var o;o=e.config.apiUrl?e.config.apiUrl:n.url,a.projects=[],t.getJobList(o).then(function(t){t.forEach(function(t){var e={name:t.name};a.projects.push(e)})})},e.updateProjects()}])}(window);