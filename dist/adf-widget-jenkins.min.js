!function(t,e){"use strict";function a(t){var e="Jenkins";t.widget("jenkinsBuildReport",{title:"Jenkins Build Report",description:"Displays current build information",category:e,templateUrl:"{widgetsPath}/jenkins/src/view.html",resolve:{data:["jenkinsApi","config","jenkinsEndpoint",function(t,e,a){return e.apiUrl?t.getJobData(e.apiUrl,e.project):a.url&&e.project?t.getJobData(a.url,e.project):void 0}]},controller:"jenkinsJobList",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/jenkins/src/edit.html",controller:"projectViewEditController",controllerAs:"vm"}}).widget("jenkinsGlobalStatistics",{title:"Jenkins Global Statistics",description:"Displays all build jobs as pie chart",category:e,templateUrl:"{widgetsPath}/jenkins/src/charts/view.html",resolve:{data:["jenkinsApi","config","jenkinsEndpoint",function(t,e,a){return e.apiUrl?t.getJobStats(e.apiUrl):a.url?t.getJobStats(a.url):"Please Setup the Widget"}]},controller:"jenkinsChart",controllerAs:"jc",edit:{templateUrl:"{widgetsPath}/jenkins/src/charts/edit.html"}})}function n(t){function a(t){return t+"/api/json/jobs"}function n(t,e){return t+"/job/"+e+"/lastBuild/api/json"}function o(t){for(var e=0,a=0,n=0,o=0,l=0,i=t.length,r=0;r<i;r++)"blue"==t[r].color&&e++,"red"==t[r].color&&n++,"yellow"==t[r].color&&a++,"notbuilt"!=t[r].color&&"disabled"!=t[r].color||o++,"aborted"==t[r].color&&l++;return{stable:e,fail:n,unstable:a,aborted:l,disabled:o,total:i}}function l(e){var a=e+"/api/json?tree=jobs[name,buildable,color,jobs[name,buildable,color,jobs[name,buildable,color,jobs[name,buildable,color,jobs]]]]&pretty";return t({method:"GET",url:a,headers:{Accept:"application/json"}}).then(function(t){return i(t.data)})}function i(t){var a=t.name,n=[];return t.jobs.forEach(function(t){t.buildable&&(a===e||null==a?n.push({name:t.name,color:t.color}):n.push({name:a+" / "+t.name,color:t.color})),t.jobs&&n.push(i(t))}),n}function r(e){var n=a(e);return t({method:"GET",url:n,headers:{Accept:"application/json"}}).then(function(t){return t.data.jobs})}function s(t){return r(t)}function c(e,a){var o=n(e,a);return t({method:"GET",url:o,headers:{Accept:"application/json"}}).then(function(t){var e=t.data.result,a=t.data.url,n=t.data.fullDisplayName,o=m;"SUCCESS"==e?o=u:"FAILURE"==e&&(o=p);var l=t.data.changeSet.items[0],i=h,r=b;return l&&(r=l.author.fullName,i=l.msg),{status:e,url:a,lastCommitBy:r,lastCommitMsg:i,imgUrl:o,projectFullName:n}})}function d(t){return l(t).then(o)}const u="src/images/success.png",p="src/images/failed.png",m="src/images/unstable.png",b="No author found",h="No commit information found";return{getJobList:r,getJobStats:d,getJobData:c,getLastBuilds:s,crawlJenkinsJobs:l}}var o=angular.module("adf.widget.jenkins",["adf.provider","chart.js","ui.bootstrap"]).constant("jenkinsEndpoint",{url:"http://builds.apache.org"}).config(a);a.$inject=["dashboardProvider"],angular.module("adf.widget.jenkins").run(["$templateCache",function(t){t.put("{widgetsPath}/jenkins/src/edit.html",'<form role=form><div class=form-group><label>Connection Setup</label><p><input class=form-control id=apiUrl ng-model=config.apiUrl placeholder="Enter Api-Url" type=text ng-change=updateProjects()></p><label>Project</label> <input type=text ng-model=config.project uib-typeahead="project.name for project in vm.projects | filter:$viewValue | limitTo:10" class=form-control></div></form>'),t.put("{widgetsPath}/jenkins/src/view.html",'<style type=text/css>\n\n  .statusImg {\n    max-width: 100px;\n  }\n\n</style><div><div class=content><div ng-if=vm.data><div class="col-md-6 col-xs-6"><a href=\'{{vm.data.url}}target="_blank"\'><h4>{{vm.data.projectFullName}}</h4></a><p><b>Last Commit:</b> {{vm.data.lastCommitMsg}}</p><footer><b>Author:</b> {{vm.data.lastCommitBy}}</footer></div><div class="col-md-6 col-xs-6 pull-right"><img class="statusImg pull-right" src={{vm.data.imgUrl}}></div></div></div></div>'),t.put("{widgetsPath}/jenkins/src/charts/edit.html",'<form role=form><div class=form-group><label for=sample>Connection Setup</label><p><input class=form-control id=apiUrl ng-model=config.apiUrl placeholder="Enter Api-Url" type=text></p></div></form>'),t.put("{widgetsPath}/jenkins/src/charts/view.html",'<style type=text/css>\n  #stable{\n    background-color: #009587;\n  }\n  #failed{\n    background-color: #F34235;\n  }\n  #unstable{\n    background-color: #FEC006;\n  }\n  #disabled{\n    background-color: #DCDCDC;\n  }\n  .counter {\n    outline: 2px solid #ddd;\n    height: 100px;\n  }\n</style><div><div class=content><canvas id=doughnut class="chart chart-doughnut" chart-data=jc.chartValues chart-labels=jc.chartLabels chart-colours=jc.chartColors></canvas><div class="counter col-md-6" id=stable><h1>{{jc.data.stable || 0}}</h1>stable builds</div><div class="counter col-md-6" id=unstable><h1>{{jc.data.unstable || 0}}</h1>unstable builds</div><div class="counter col-md-6" id=failed><h1>{{jc.data.fail || 0}}</h1>failed builds</div><div class="counter col-md-6" id=disabled><h1>{{jc.data.aborted+jc.data.disabled || 0}}</h1>disabled builds</div></div></div>')}]),o.controller("jenkinsChart",["data",function(t){var e=this;e.data=t;var a=["Stable","Fail","Unstable","Diabled"],n=[e.data.stable,e.data.fail,e.data.unstable,e.data.disabled],o=["#009587","#F34235","#FEC006","#DCDCDC"];e.chartLabels=a,e.chartValues=n,e.chartColors=o}]),o.controller("jenkinsJobList",["data",function(t){var e=this;e.data=t}]),o.factory("jenkinsApi",n),n.$inject=["$http"],angular.module("adf.widget.jenkins").controller("projectViewEditController",["jenkinsApi","$scope","jenkinsEndpoint",function(t,e,a){var n=this;e.updateProjects=function(){var o;o=e.config.apiUrl?e.config.apiUrl:a.url,n.projects=[],t.crawlJenkinsJobs(o).then(function(t){t.forEach(function(t){var e={name:t.name};n.projects.push(e)})})},e.updateProjects()}])}(window);