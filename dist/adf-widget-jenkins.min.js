!function(t,a){"use strict";function e(t){var a="Jenkins";t.widget("jenkinsBuildReport",{title:"Jenkins Build Report",description:"Displays current build information",category:a,templateUrl:"{widgetsPath}/jenkins/src/view.html",resolve:{data:["jenkinsApi","config","jenkinsEndpoint",function(t,a,e){return a.apiUrl?t.getJobData(a.apiUrl,a.project):e.url&&a.project?t.getJobData(e.url,a.project):void 0}]},controller:"jenkinsJobList",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/jenkins/src/edit.html",controller:"projectViewEditController",controllerAs:"vm"}}).widget("jenkinsGlobalStatistics",{title:"Jenkins Global Statistics",description:"Displays all build jobs as pie chart",category:a,templateUrl:"{widgetsPath}/jenkins/src/charts/view.html",resolve:{data:["jenkinsApi","config","jenkinsEndpoint",function(t,a,e){return a.apiUrl?t.getJobStats(a.apiUrl):e.url?t.getJobStats(e.url):"Please Setup the Widget"}]},controller:"jenkinsChart",controllerAs:"jc",edit:{templateUrl:"{widgetsPath}/jenkins/src/charts/edit.html"}})}function n(t){function e(t){return t+"/api/json/jobs"}function n(t,a){return t+"/job/"+a+"/lastBuild/api/json"}function o(t){for(var a=0,e=0,n=0,o=0,l=0,r=t.length,i=0;i<r;i++)"blue"==t[i].color&&a++,"red"==t[i].color&&n++,"yellow"==t[i].color&&e++,"notbuilt"!=t[i].color&&"disabled"!=t[i].color||o++,"aborted"==t[i].color&&l++;return{stable:a,fail:n,unstable:e,aborted:l,disabled:o,total:r}}function l(a){var e=a+"/api/json?tree=jobs[name,buildable,color,jobs[name,buildable,color,jobs[name,buildable,color,jobs[name,buildable,color,jobs]]]]&pretty";return t({method:"GET",url:e,headers:{Accept:"application/json"}}).then(function(t){var a=[];return a=r(t.data,a)})}function r(t,e){var n=t.name;return t.jobs.forEach(function(t){t.buildable&&(n===a||null==n?e.push({name:t.name,color:t.color}):e.push({name:n+" / "+t.name,color:t.color})),t.jobs&&r(t,e)}),e}function i(a){var n=e(a);return t({method:"GET",url:n,headers:{Accept:"application/json"}}).then(function(t){return t.data.jobs})}function s(t){return i(t)}function c(a,e){var o=n(a,e);return t({method:"GET",url:o,headers:{Accept:"application/json"}}).then(function(t){var a=t.data.result,e=t.data.url,n=t.data.fullDisplayName,o=m;"SUCCESS"==a?o=u:"FAILURE"==a&&(o=p);var l=t.data.changeSet.items[0],r=h,i=b;return l&&(i=l.author.fullName,r=l.msg),{status:a,url:e,lastCommitBy:i,lastCommitMsg:r,imgUrl:o,projectFullName:n}})}function d(t){return l(t).then(o)}const u="src/img/successful.png",p="src/img/failed.png",m="src/img/unstable.png",b="No author found",h="No commit information found";return{getJobList:i,getJobStats:d,getJobData:c,getLastBuilds:s,crawlJenkinsJobs:l}}var o=angular.module("adf.widget.jenkins",["adf.provider","chart.js","ui.bootstrap"]).constant("jenkinsEndpoint",{url:"http://builds.apache.org"}).config(e);e.$inject=["dashboardProvider"],angular.module("adf.widget.jenkins").run(["$templateCache",function(t){t.put("{widgetsPath}/jenkins/src/edit.html",'<form role=form><div class=form-group><label>Connection Setup</label><p><input class=form-control id=apiUrl ng-model=config.apiUrl placeholder="Enter Api-Url" type=text ng-change=updateProjects()></p><label>Project</label> <input type=text ng-model=config.project uib-typeahead="project.name for project in vm.projects | filter:$viewValue | limitTo:10" class=form-control></div></form>'),t.put("{widgetsPath}/jenkins/src/view.html",'<style type=text/css>\n\n  .statusImg {\n    max-width: 125px;\n  }\n\n</style><div><div class=content><div ng-if=vm.data><div class="col-md-6 col-xs-6"><a href=\'{{vm.data.url}}target="_blank"\'><h4>{{vm.data.projectFullName}}</h4></a><p><b>Last Commit:</b> {{vm.data.lastCommitMsg}}</p><footer><b>Author:</b> {{vm.data.lastCommitBy}}</footer></div><div class="col-md-6 col-xs-6 pull-right"><img class="statusImg pull-right" src={{vm.data.imgUrl}}></div></div></div></div>'),t.put("{widgetsPath}/jenkins/src/charts/edit.html",'<form role=form><div class=form-group><label for=sample>Connection Setup</label><p><input class=form-control id=apiUrl ng-model=config.apiUrl placeholder="Enter Api-Url" type=text></p></div></form>'),t.put("{widgetsPath}/jenkins/src/charts/view.html",'<style type=text/css>\n  #stable{\n    background-color: #009587;\n  }\n  #failed{\n    background-color: #F34235;\n  }\n  #unstable{\n    background-color: #FEC006;\n  }\n  #disabled{\n    background-color: #DCDCDC;\n  }\n  .counter {\n    outline: 2px solid #ddd;\n    height: 100px;\n  }\n</style><div><div class=content><canvas id=doughnut class="chart chart-doughnut" chart-data=jc.chartValues chart-labels=jc.chartLabels chart-colours=jc.chartColors></canvas><div class="counter col-md-6" id=stable><h1>{{jc.data.stable || 0}}</h1>stable builds</div><div class="counter col-md-6" id=unstable><h1>{{jc.data.unstable || 0}}</h1>unstable builds</div><div class="counter col-md-6" id=failed><h1>{{jc.data.fail || 0}}</h1>failed builds</div><div class="counter col-md-6" id=disabled><h1>{{jc.data.aborted+jc.data.disabled || 0}}</h1>disabled builds</div></div></div>')}]),o.controller("jenkinsChart",["data",function(t){var a=this;a.data=t;var e=["Stable","Fail","Unstable","Diabled"],n=[a.data.stable,a.data.fail,a.data.unstable,a.data.disabled],o=["#009587","#F34235","#FEC006","#DCDCDC"];a.chartLabels=e,a.chartValues=n,a.chartColors=o}]),o.controller("jenkinsJobList",["data",function(t){var a=this;a.data=t}]),o.factory("jenkinsApi",n),n.$inject=["$http"],angular.module("adf.widget.jenkins").controller("projectViewEditController",["jenkinsApi","$scope","jenkinsEndpoint",function(t,a,e){var n=this;a.updateProjects=function(){var o;o=a.config.apiUrl?a.config.apiUrl:e.url,n.projects=[],t.crawlJenkinsJobs(o).then(function(t){t.forEach(function(t){var a={name:t.name};n.projects.push(a)})})},a.updateProjects()}])}(window);